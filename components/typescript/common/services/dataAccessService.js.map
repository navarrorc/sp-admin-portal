{"version":3,"sources":["common/services/dataAccessService.ts"],"names":["app","app.common","app.common.getQueryStringParameter","app.common.getSPCurrentUser","app.common.getSPUserProfile","DataAccessService","DataAccessService.constructor","DataAccessService.getUser","DataAccessService.getProfile"],"mappings":"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","file":"d:/AppDev/sp-admin-portal/components/typescript/common/services/dataAccessService.js","sourcesContent":["module app.common {\r\n\tvar web: SP.Web,\r\n\t\thostweburl: string,\r\n\t\tappweburl: string\r\n\t\t//user: SP.User;\r\n\r\n\tfunction getQueryStringParameter(param: string) {\r\n\t\tvar params = document.URL.split(\"?\")[1].split(\"&\");\r\n\t\tvar strParams = \"\";\r\n\t\tfor (var i = 0; i < params.length; i = i + 1) {\r\n\t\t\tvar singleParam = params[i].split(\"=\");\r\n\t\t\tif (singleParam[0] == param) {\r\n\t\t\t\treturn singleParam[1];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Current User\r\n\t */\r\n\tfunction getSPCurrentUser(): JQueryPromise<{}> {\r\n\t\tvar context: SP.ClientContext,\r\n\t\t\tfactory: SP.ProxyWebRequestExecutorFactory,\r\n\t\t\tappContextSite: SP.AppContextSite,\r\n\t\t\tuser: SP.User;\r\n\r\n\t\tvar deferred = $.Deferred();\r\n\r\n\t\tcontext = new SP.ClientContext(appweburl);\r\n\t\tfactory = new SP.ProxyWebRequestExecutorFactory(appweburl);\r\n\t\tcontext.set_webRequestExecutorFactory(factory);\r\n\t\tappContextSite = new SP.AppContextSite(context, appweburl);\r\n\r\n\t\tweb = appContextSite.get_web();\r\n\t\tuser = web.get_currentUser();\r\n\r\n\t\tcontext.load(user);\r\n\t\tcontext.executeQueryAsync(\r\n\t\t\tfunction() {\r\n\t\t\t\tdeferred.resolve(user);\r\n\t\t\t},\r\n\t\t\tfunction(sender: any, args: any) {\r\n\t\t\t\tdeferred.reject(sender, args);\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\treturn deferred.promise();\r\n\t}\r\n\t\r\n\t/**\r\n\t * User Profile\r\n\t */\r\n\tfunction getSPUserProfile() {\r\n\t\tvar context: SP.ClientContext,\r\n\t\tfactory: SP.ProxyWebRequestExecutorFactory,\r\n\t\tappContextSite: SP.AppContextSite,\r\n\t\tpeopleManager: SP.UserProfiles.PeopleManager,\r\n\t\tpersonProperties: SP.UserProfiles.PersonProperties;\r\n\r\n\t\tvar deferred = $.Deferred();\r\n\t\t\r\n\t  console.info(\"outside getProperties()\");\r\n\t\t\r\n\t\t//SP.SOD.executeOrDelayUntilScriptLoaded(getProperties, 'sp.js');\r\n\t\t//function getProperties() {\r\n\t\t\tconsole.info(\"inside getProperties()\");\r\n\r\n\t\t\tcontext = new SP.ClientContext(appweburl);\r\n\t\t\tfactory = new SP.ProxyWebRequestExecutorFactory(appweburl);\r\n\t\t\tcontext.set_webRequestExecutorFactory(factory);\r\n\t\t\tappContextSite = new SP.AppContextSite(context, appweburl);\r\n\r\n\r\n\t\t\tpeopleManager = new SP.UserProfiles.PeopleManager(context);\r\n\r\n\t\t\tpersonProperties = peopleManager.getMyProperties();\r\n\r\n\t\t\tcontext.load(personProperties);\r\n\r\n\t\t\tcontext.executeQueryAsync(\r\n\t\t\t\tfunction() {\r\n\t\t\t\t\tvar properties = personProperties.get_userProfileProperties();\r\n\t\t\t\t\tconsole.info(\"first name: \", properties[\"FirstName\"]);\r\n\t\t\t\t\tdeferred.resolve(properties);\r\n\t\t\t\t},\r\n\t\t\t\tfunction(sender: any, args: any) {\r\n\t\t\t\t\tdeferred.reject(sender, args);\r\n\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t//}\t\r\n\t\t\r\n\t\treturn deferred.promise();\t\t\r\n\t\t\r\n\t}\r\n\r\n\tvar sharePointReady = function() {\r\n\t\thostweburl = decodeURIComponent(getQueryStringParameter('SPHostUrl'));\r\n    appweburl = decodeURIComponent(getQueryStringParameter('SPAppWebUrl'));\r\n    var scriptbase = hostweburl + '/_layouts/15/';\r\n\t\treturn {\r\n\t\t\t// Get the current SP.User using CSOM\r\n\t\t\tgetUser: function() {\r\n\t\t\t\treturn $.when(\r\n\t\t\t\t\t$.getScript(scriptbase + 'init.js'),\r\n\t\t\t\t\t$.getScript(scriptbase + 'SP.Core.js'),\r\n\t\t\t\t\t$.getScript(scriptbase + 'SP.Runtime.js'),\r\n\t\t\t\t\t$.getScript(scriptbase + 'SP.js'),\r\n\t\t\t\t\t$.getScript(scriptbase + 'SP.RequestExecutor.js'),\r\n\t\t\t\t\t$.Deferred(function(deferred) {\r\n\t\t\t\t\t\t$(deferred.resolve);\r\n\t\t\t\t\t})\r\n\t\t\t\t\t).then(getSPCurrentUser); // returns a JQueryPromise<{}>\r\n\t\t\t},\r\n\t\t\tgetUserProfile: function() {\r\n\t\t\t\treturn $.when(\r\n\t\t\t\t\t$.getScript(scriptbase + 'init.js', \r\n\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\t$.getScript(scriptbase + 'SP.Runtime.js', \r\n\t\t\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\t\t\t$.getScript(scriptbase + 'SP.js', \r\n\t\t\t\t\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\t\t\t\t\t$.getScript(scriptbase + 'SP.Taxonomy.js', \r\n\t\t\t\t\t\t\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t$.getScript(scriptbase + 'SP.UserProfiles.js',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$.getScript(scriptbase + 'SP.RequestExecutor.js')\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}),\t\t\t\t\t\r\n\t\t\t\t\t// $.getScript(scriptbase + 'init.js'),\r\n\t\t\t\t\t// //$.getScript(scriptbase + 'SP.Core.js'),\r\n\t\t\t\t\t// $.getScript(scriptbase + 'SP.Runtime.js'),\r\n\t\t\t\t\t// $.getScript(scriptbase + 'SP.js'),\r\n\t\t\t\t\t// $.getScript(scriptbase + 'SP.Taxonomy.js'),\t\t\t\t\t\r\n\t\t\t\t\t// $.getScript(scriptbase + 'SP.UserProfiles.js'),\r\n\t\t\t\t\t// $.getScript(scriptbase + 'SP.RequestExecutor.js'),\r\n\t\t\t\t\t\t?\r\n\t\t\t\t\t).then(getSPUserProfile); // returns a JQueryPromise<{}>\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\t}\r\n\r\n\texport class DataAccessService {\r\n\t\tconstructor() {\r\n\t\t}\r\n\r\n\t\tgetUser() {\r\n\t\t\treturn sharePointReady().getUser();\r\n\t\t}\r\n\t\t\r\n\t\tgetProfile() {\r\n\t\t\treturn sharePointReady().getUserProfile();\r\n\t\t}\r\n\t}\r\n\r\n\tangular\r\n\t\t.module(\"common.services\")\r\n\t\t.service(\"DataAccessService\",\r\n\t\t\t\t\t\tDataAccessService);\r\n}"],"sourceRoot":"/source/"}